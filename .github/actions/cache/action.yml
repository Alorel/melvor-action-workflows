inputs:
  node-version:
    description: Node version
    required: true
  path:
    description: Path under "node_modules./cache"
    required: true
  cache-key-cmd:
    description: Command used to make the cache key
    required: true
  prefix:
    description: cache-key-prefix
    required: true
name: Set up cache
description: Set up caching
runs:
  using: composite
  steps:
    - name: Make key
      shell: bash
      run: ${{ inputs.cache-key-cmd }} > .ci-cache-key
    - uses: actions/cache@v3
      name: Cache
      with:
        path: "./node_modules/.cache/${{ inputs.path }}"
        key: ${{ inputs.prefix }}-${{ runner.os }}-${{ inputs.node-version }}-${{ hashFiles('./.ci-cache-key') }}
        restore-keys: |
          ${{ inputs.prefix }}-${{ runner.os }}-${{ inputs.node-version }}-
          ${{ inputs.prefix }}-${{ runner.os }}
    - name: Cleanup
      shell: bash
      if: always()
      run: rm .ci-cache-key
